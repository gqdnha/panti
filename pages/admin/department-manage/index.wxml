<view class="container">
    <view class="title">部门管理</view>
    <view class="desc">可对部门进行停用/启用和导出操作</view>

    <!-- 搜索框（保留注释，如需可启用） -->
    <!-- <view class="search-bar">
    <input class="search-input" placeholder="搜索部门名称" value="{{searchKeyword}}" bindinput="onSearchInput" />
    <button class="search-btn" bindtap="onSearch">搜索</button>
  </view> -->

    <view class="dept-list">
        <!-- 外层循环一级部门 -->
        <block wx:for="{{departments}}" wx:key="level1Name" wx:for-item="level1">
            <!-- 内层循环二级部门 -->
            <block wx:for="{{level1.level2Departments}}" wx:key="id" wx:for-item="level2">
                <view class="dept-item">
                    <view class="dept-info">
                        <view class="dept-nameList">
                            <text class="dept-name">{{level2.department}}</text>
                            <text class="dept-level1">({{level1.level1Name}})</text>
                        </view>
                        <text class="dept-status {{level2.isActive ? 'active' : 'inactive'}}">
                            {{level2.isActive ? '已停用' : '已授权'}}
                        </text>
                    </view>
                    <view class="dept-actions">
                        <button class="action-btn toggle" bindtap="toggleDeptStatus" data-department="{{level2.department}}">
                            {{level2.isActive ? '授权' : '禁用'}}
                        </button>
                        <button class="action-btn export" bindtap="exportDept" data-name="{{level2.department}}">
                            导出
                        </button>
                    </view>
                </view>
            </block>
        </block>

        <!-- 空状态提示（修复判断逻辑） -->
        <view class="empty-tip" wx:if="{{isNoDepartmentData}}">
            暂无部门数据
        </view>
    </view>
</view>