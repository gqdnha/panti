<!--pages/stats/answer-stats/index.wxml-->
<view class="container">
  <!-- 顶部统计卡片 -->
  <view class="stats-card">
    <view class="stats-header">
      <text class="title">学习概览</text>
      <view class="date-picker">
        <picker mode="date" fields="month" value="{{currentDate}}" bindchange="onDateChange">
          <text>{{currentDate}}</text>
        </picker>
      </view>
    </view>
    <view class="stats-content">
      <view class="stat-item">
        <text class="value">{{totalTime}}</text>
        <text class="label">累计学习时长(分钟)</text>
      </view>
      <view class="stat-item">
        <text class="value">{{correctRate}}%</text>
        <text class="label">正确率</text>
      </view>
      <view class="stat-item">
        <text class="value">{{wrongCount}}</text>
        <text class="label">错题总数</text>
      </view>
    </view>
  </view>

  <!-- 正确率趋势图 -->
  <view class="chart-card">
    <view class="chart-header">
      <text class="title">正确率趋势</text>
      <view class="tab-group">
        <view class="tab {{timeRange === 'week' ? 'active' : ''}}" bindtap="switchTimeRange" data-range="week">周</view>
        <view class="tab {{timeRange === 'month' ? 'active' : ''}}" bindtap="switchTimeRange" data-range="month">月</view>
      </view>
    </view>
    <view class="chart-content">
      <!-- 这里使用echarts-for-weixin组件 -->
      <ec-canvas id="correctRateChart" canvas-id="correctRateChart" ec="{{ ec }}"></ec-canvas>
    </view>
  </view>

  <!-- 错题本分类 -->
  <view class="wrong-questions-card">
    <view class="card-header">
      <text class="title">错题本分类</text>
      <view class="filter-group">
        <picker mode="selector" range="{{questionTypes}}" value="{{selectedType}}" bindchange="onTypeChange">
          <view class="filter-item">
            <text>题型：{{questionTypes[selectedType]}}</text>
          </view>
        </picker>
        <picker mode="selector" range="{{knowledgePoints}}" value="{{selectedPoint}}" bindchange="onPointChange">
          <view class="filter-item">
            <text>知识点：{{knowledgePoints[selectedPoint]}}</text>
          </view>
        </picker>
      </view>
    </view>
    <view class="wrong-list">
      <view class="wrong-item" wx:for="{{wrongQuestions}}" wx:key="id" bindtap="goToQuestion" data-id="{{item.id}}">
        <view class="question-info">
          <text class="type">{{item.type}}</text>
          <text class="count">已答对{{item.correctCount}}次</text>
        </view>
        <view class="question-content">{{item.content}}</view>
        <view class="question-meta">
          <text class="knowledge-point">知识点：{{item.knowledgePoint}}</text>
          <text class="time">{{item.lastWrongTime}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 错题强化按钮 -->
  <view class="action-bar">
    <button class="practice-btn" bindtap="startPractice">开始错题强化</button>
  </view>
</view>